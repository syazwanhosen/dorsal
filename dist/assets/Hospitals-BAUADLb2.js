import{j as e}from"./radix-hoWLJplZ.js";import{u as X,h as O,L as Q,M as v,O as L,P as $,Q as T,R as Z,T as M,V as q,W as se,X as te,Y as V,Z as I,k as ae,_ as W,$ as re,a0 as ce,N as oe,H as ie,F as le,S as ne}from"./index-Bl-JI4NS.js";import{u as de,f as ue,a as g}from"./react-DyejIWKk.js";import{P as pe,H as ge,h as me,S as he}from"./hospital-D9YWEQkI.js";import{M as fe,T as xe,a as ye,l as be,P as ve,u as z}from"./maps-Cu4X6U0v.js";import{S as we}from"./Spinner-D0Y5dMqM.js";import"./redux-CrWtP8Qi.js";import"./ui-lp5hxHkm.js";import"./charts-ZmEBPBrd.js";const je=r=>Object.entries(r).filter(([d,t])=>t==null?void 0:t.trim()).map(([d,t])=>`${d}=${encodeURIComponent(t)}`).join("&"),_e=(r,d)=>{var t,o,m,l,x,y,w;return(t=r.state)!=null&&t.trim()&&!d.state.includes(r.state.trim())?{isValid:!1,message:"Please select a valid State"}:(o=r.category)!=null&&o.trim()?!((m=r.subcategory)!=null&&m.trim())||!d.subcategory.includes(r.subcategory.trim())?{isValid:!1,message:"Please select a valid Subcategory"}:!((l=r.cpt)!=null&&l.trim())&&!((x=r.service)!=null&&x.trim())?{isValid:!1,message:"Please select either a CPT code or Service name"}:(y=r.cpt)!=null&&y.trim()&&!d.cpt.includes(r.cpt.trim())?{isValid:!1,message:"Please select a valid CPT code"}:(w=r.service)!=null&&w.trim()&&!d.service.includes(r.service.trim())?{isValid:!1,message:"Please select a valid Service name"}:{isValid:!0}:{isValid:!1,message:"Please select a Service Category"}},Ne=()=>{const r=de(),d=ue(),t=X(),{filters:o,options:m,loading:l,isHydratingFromURL:x}=O(a=>a.hospital),y=g.useRef(!1),w=g.useRef(!1),[b,H]=g.useState(!1),[,j]=g.useState({state:!1,category:!1,subcategory:!1,cpt:!1,service:!1}),[C,_]=g.useState({cpt:!1,service:!1}),[F,A]=g.useState(null),c=(a,s=!1)=>{if(s&&w.current)return;t(q(!0)),A(null);const i=a.get("state")??"",u=a.get("service_category")??"",f=a.get("sub_category")??"",h=a.get("cpt_code")??"",N=a.get("service_name")??"";se(a).then(k=>{t(te({...k,selectedState:i,selectedServiceCategory:u,selectedSubcategory:f,selectedCptCode:h,selectedServiceName:N}))}).catch(k=>{console.error("Search error:",k),A("Failed to perform search. Please try again.")}).finally(()=>t(q(!1)))};g.useEffect(()=>{Q().then(a=>t(v({field:"state",values:a}))).catch(a=>console.error("Error loading states:",a))},[t]),g.useEffect(()=>{var a;(a=o.state)!=null&&a.trim()?L(o.state).then(s=>{let i=Array.isArray(s)?s:s.categories??s.service_categories??[];t(v({field:"category",values:i}))}).catch(s=>{console.error("Error loading categories by state:",s)}):L().then(s=>{let i=Array.isArray(s)?s:s.categories??s.service_categories??[];t(v({field:"category",values:i}))}).catch(s=>{console.error("Error loading nationwide categories:",s)})},[o.state,t]),g.useEffect(()=>{var a;o.category&&((a=o.state)!=null&&a.trim()?$(o.category,o.state).then(s=>{var u;const i=Array.isArray(s.sub_categories)?s.sub_categories:((u=s.sub_categories)==null?void 0:u.sub_categories)??[];t(v({field:"subcategory",values:i}))}).catch(s=>{console.error("Error loading subcategories by state:",s)}):$(o.category).then(s=>{var u;const i=Array.isArray(s.sub_categories)?s.sub_categories:((u=s.sub_categories)==null?void 0:u.sub_categories)??[];t(v({field:"subcategory",values:i}))}).catch(s=>{console.error("Error loading subcategories nationwide:",s)}))},[o.category,o.state,t]),g.useEffect(()=>{if(!o.subcategory)return;(o.state?T(o.subcategory,o.state):T(o.subcategory)).then(s=>{var f,h;const i=Array.isArray(s.selected_cpt_codes)?s.selected_cpt_codes:((f=s.selected_cpt_codes)==null?void 0:f.selected_cpt_codes)??[],u=Array.isArray(s.selected_service_names)?s.selected_service_names:((h=s.selected_service_names)==null?void 0:h.selected_service_names)??[];t(v({field:"cpt",values:i})),t(v({field:"service",values:u}))}).catch(s=>{console.error("Error updating CPT and Service:",s)})},[o.subcategory,o.state,t]),g.useEffect(()=>{const a=new URLSearchParams(d.search),s=a.get("state"),i=a.get("category"),u=a.get("subcategory"),f=a.get("cpt"),h=a.get("service");if(!(i&&u&&(f||h))||y.current){H(!0);return}y.current=!0,t(Z(!0)),(async()=>{var S,B,D;try{if(!m.state.length){const ee=await Q();t(v({field:"state",values:ee}))}const R=s?await L(s):await L(),Y=Array.isArray(R)?R:R.categories??R.service_categories??[];t(v({field:"category",values:Y}));const U=s?await $(i,s):await $(i),J=Array.isArray(U.sub_categories)?U.sub_categories:((S=U.sub_categories)==null?void 0:S.sub_categories)??[];t(v({field:"subcategory",values:J}));const P=s?await T(u,s):await T(u),G=Array.isArray(P.selected_cpt_codes)?P.selected_cpt_codes:((B=P.selected_cpt_codes)==null?void 0:B.selected_cpt_codes)??[],K=Array.isArray(P.selected_service_names)?P.selected_service_names:((D=P.selected_service_names)==null?void 0:D.selected_service_names)??[];t(v({field:"cpt",values:G})),t(v({field:"service",values:K})),t(M({state:s??"",category:i??"",subcategory:u??"",cpt:f??"",service:h??""}));const E=new URLSearchParams;s&&E.set("state",s),E.set("service_category",i),E.set("sub_category",u),f?E.set("cpt_code",f):h&&E.set("service_name",h),c(E,!0)}catch(R){console.error("Error hydrating from URL:",R)}finally{t(Z(!1)),H(!0)}})()},[d.search,t,m.state]);const n=(a,s)=>{let i={...o,[a]:s};a==="state"?(i={...i,category:"",subcategory:"",cpt:"",service:""},_({cpt:!1,service:!1})):a==="category"?(i={...i,subcategory:"",cpt:"",service:""},_({cpt:!1,service:!1})):a==="subcategory"&&(i={...i,cpt:"",service:""},_({cpt:!1,service:!1})),t(M(i)),j(u=>({...u,[a]:!1})),a==="cpt"?s?(_({cpt:!1,service:!0}),t(M({...i,service:""}))):i.service||_({cpt:!1,service:!1}):a==="service"&&(s?(_({cpt:!0,service:!1}),t(M({...i,cpt:""}))):i.cpt||_({cpt:!1,service:!1}))},p=()=>{if(x||!b)return;const a=_e(o,m);if(!a.isValid){alert(a.message);return}w.current=!0;const{state:s,category:i,subcategory:u,cpt:f,service:h}=o,N={};s&&(N.state=s),N.category=i,N.subcategory=u,f?N.cpt=f:h&&(N.service=h);const k=je(N);r(`/hospitals?${k}`,{replace:!0});const S=new URLSearchParams;s&&S.set("state",s),S.set("service_category",i),S.set("sub_category",u),f?S.set("cpt_code",f):h&&S.set("service_name",h),c(S)};return e.jsx(e.Fragment,{children:e.jsxs("section",{id:"SearchHospital",className:"container py-6 px-4 sm:px-6 md:px-4 lg:px-8 xl:px-16",children:[e.jsxs("div",{className:"flex flex-wrap lg:flex-nowrap items-center border border-purple-400 rounded overflow-hidden bg-white text-sm",children:[e.jsx("div",{className:"flex flex-wrap flex-grow",children:[{key:"state",label:"State",placeholder:"Select State"},{key:"category",label:"Service Category",placeholder:"Select Service Category"},{key:"subcategory",label:"Subcategory",placeholder:"Select Subcategory"},{key:"cpt",label:"CPT Code",placeholder:"Select CPT Code",disabled:C.cpt},{key:"service",label:"Service Name",placeholder:"Select Service Name",disabled:C.service}].map(a=>e.jsxs("div",{className:"relative w-full sm:w-1/2 md:w-1/3 lg:w-1/5 lg:border-r md:border-r p-2",children:[e.jsx("label",{className:"block text-xs text-black font-semibold",children:a.label}),e.jsxs("select",{className:`w-full focus:outline-none text-sm ${a.disabled?"bg-gray-100 cursor-not-allowed":""}`,value:o[a.key],onChange:s=>n(a.key,s.target.value),disabled:x||(a.key==="subcategory"?!o.category:a.key==="cpt"?C.cpt||!o.subcategory:a.key==="service"?C.service||!o.subcategory:!1),children:[e.jsx("option",{value:"",children:a.placeholder}),Array.isArray(m[a.key])&&m[a.key].map((s,i)=>e.jsx("option",{value:s,children:s},i))]})]},a.key))}),e.jsx("button",{onClick:p,disabled:x||l,className:`bg-purple hover:bg-purple-700 text-white px-10 lg:py-4 py-2 sm:px-10 text-sm font-semibold border lg:w-auto w-full ${x||l?"opacity-50 cursor-not-allowed":""}`,children:l?"Searching...":"SEARCH"})]}),F&&e.jsx("div",{className:"mt-4 text-red-500 text-sm",children:F})]})})},Se=({serviceName:r,serviceDescription:d,cptCode:t,hasSearchResult:o,prices:m,hospitalNames:l})=>e.jsx("section",{id:"ProcedureCard",className:"mt-2 container px-4 sm:px-6 md:px-4 lg:px-8 xl:px-16",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start justify-between space-y-4 lg:space-y-0 lg:space-x-6",children:[e.jsxs("div",{className:"w-full lg:w-[60%]",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:r}),t&&e.jsxs("span",{className:"bg-purple text-white text-xs font-semibold px-2 py-1 rounded w-fit sm:w-auto",children:["CPT Code ",t]})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-2",children:d})]}),o&&e.jsx("div",{className:"w-full lg:w-[40%] rounded-lg border",children:e.jsx(pe,{prices:m,hospitalNames:l})})]})}),Ce="zt7wt1ZXSBmlye8q8IQ6HuOv6p4idsbIbLl3Qi2ns2X4ZcbQbarIZpGE6YAkfi6L",ke=new be.Icon({iconUrl:me,iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]}),Re=({sidebarOpen:r})=>{const d=z();return g.useEffect(()=>{const t=setTimeout(()=>{d.invalidateSize({animate:!0})},500);return()=>clearTimeout(t)},[r,d]),null},Pe=({location:r})=>{const d=z();return g.useEffect(()=>{r!=null&&r.every(t=>typeof t=="number"&&!isNaN(t))&&d.flyTo(r,15,{duration:1.5})},[r,d]),null},Ee=({hospitals:r})=>{const d=z();return g.useEffect(()=>{const t=r.filter(o=>[o.latitude,o.longitude].every(m=>typeof m=="number"&&!isNaN(m))).map(o=>[o.latitude,o.longitude]);t.length>0&&d.fitBounds(t,{padding:[50,50]})},[r,d]),null},Ae=()=>{const r=X(),[d,t]=g.useState(!1),[o,m]=g.useState(0),{searchResults:l,hospitals:x,selectedHospitals:y,sortOption:w,sidebarOpen:b,selectedLocation:H}=O(c=>({searchResults:c.hospital.searchResults,...c.hospitalMap}));g.useEffect(()=>{r(V([])),r(I([])),m(0)},[l,r]);const j=g.useMemo(()=>{const c=x.filter(n=>[n.latitude,n.longitude].every(p=>typeof p=="number"&&!isNaN(p)));return m(x.length-c.length),c.sort((n,p)=>w==="lowestPrice"?n.price-p.price:w==="shortestDistance"?parseFloat(n.distance)-parseFloat(p.distance):0)},[w,x]),C=g.useMemo(()=>{const c=j.find(n=>[n.latitude,n.longitude].every(p=>typeof p=="number"&&!isNaN(p)));return c?[c.latitude,c.longitude]:[39.8283,-98.5795]},[j]);g.useEffect(()=>{var c;(c=l==null?void 0:l.hospital_names)!=null&&c.length&&(t(!0),ae(l.hospital_names).then(n=>{console.log("Raw API Response:",n);const p=[],a=n.map((s,i)=>{var h;const u=l.hospital_names[i];return typeof s.latitude=="number"&&typeof s.longitude=="number"&&!isNaN(s.latitude)&&!isNaN(s.longitude)||(p.push({name:u,index:i}),console.warn(`Hospital missing coordinates: ${u} at index ${i}`)),Object.keys(s).length===0&&console.error(`Empty hospital data received for: ${u} at index ${i}`),{...s,name:u,price:((h=l.prices)==null?void 0:h[i])||0,title:l.generic_service_name||"Unknown Service",description:l.service_description||"No description available",zipcode:l.cpt_hcpcs_code||"N/A"}});p.length>0&&(console.group("Hospitals with missing location data"),p.forEach(s=>{console.log(`- ${s.name} (index ${s.index})`)}),console.groupEnd()),r(V(a)),m(p.length)}).catch(n=>{console.error("Error fetching hospital metadata:",n),r(V([]))}).finally(()=>t(!1)))},[l,r]);const _=c=>{y.length<2&&!y.includes(c)?r(I([...y,c])):alert("You can only compare up to 2 hospitals at a time.")},F=c=>{r(I(y.filter(n=>n.name!==c)))},A=c=>{if(!l)return;const n=new URLSearchParams;n.set("name",encodeURIComponent(c.name)),l.selectedServiceName?n.set("service",encodeURIComponent(l.selectedServiceName)):l.cpt_hcpcs_code&&n.set("code",encodeURIComponent(l.cpt_hcpcs_code));const p=`/hospital_details?${n.toString()}`;setTimeout(()=>{window.open(p,"_blank")},100)};return e.jsx(e.Fragment,{children:e.jsxs("section",{id:"MapResult",className:"container pb-6 mt-2 px-4 sm:px-6 md:px-4 lg:px-8 xl:px-16",children:[e.jsxs("div",{className:"relative lg:mt-12 mt-8 flex flex-col lg:flex-row rounded-xl overflow-hidden border border-purple-200 shadow-md h-[90vh] w-full max-w-screen-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>r(W(!b)),className:`lg:hidden z-20 h-12 w-full flex items-center justify-center bg-white shadow-sm transition-all duration-300 ${b?"border-b border-gray-200":""}`,children:[e.jsx("span",{className:"text-gray-600 mr-2",children:b?"Hide Results":"Show Results"}),e.jsx("svg",{className:`w-5 h-5 text-gray-600 transition-transform duration-300 ${b?"rotate-180":""}`,fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15 19l-7-7 7-7"})})]}),e.jsx("button",{onClick:()=>r(W(!b)),className:`absolute z-20 top-4 h-12 w-10 items-center justify-center bg-white shadow-sm transition-all duration-300 hidden lg:flex ${b?"left-[calc(31%-16px)]":"left-0"} rounded-tr-lg rounded-br-lg hidden lg:block`,children:e.jsx("svg",{className:`w-5 h-5 text-gray-600 transition-transform duration-300 ${b?"":"rotate-180"}`,fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:`${b?`lg:w-[30%] ${x.length<=1?"h-auto":"h-[40vh]"} lg:h-full`:"h-0 lg:h-full lg:w-0"} 
            transition-all duration-500 ease-in-out overflow-auto bg-white`,children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:[j.length," Results",o>0&&e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",o," hidden due to missing locations)"]})]}),e.jsx("select",{value:w,onChange:c=>r(re(c.target.value)),className:"border border-gray-300 lg:px-8 px-6 py-1 rounded-md text-sm",children:e.jsx("option",{value:"lowestPrice",children:"Lowest Price"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:d?e.jsx("div",{className:"px-4 pb-4 text-center",children:"Loading hospitals..."}):x.length===0?e.jsx("div",{className:"px-4 pb-4 text-center text-gray-500",children:"No hospitals found matching your criteria"}):e.jsx("div",{className:"px-4 pb-4 space-y-4",children:j.map(c=>{const n=[c.latitude,c.longitude].every(p=>typeof p=="number"&&!isNaN(p));return e.jsxs("div",{onClick:()=>{n&&r(ce([c.latitude,c.longitude]))},className:"border-b border-gray-200 pb-4 cursor-pointer hover:bg-purple-50 p-2 transition last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:e.jsx("button",{onClick:p=>{p.stopPropagation(),A(c)},className:"text-black hover:underline hover:text-purple-700 text-left",children:c.name})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),_(c)},className:`ml-2 px-3 py-1 text-xs font-medium text-[#8770BC] bg-[#EEEBF4] rounded hover:bg-[#e0d9f0] transition ${n?"":"opacity-50 cursor-not-allowed"}`,disabled:!n,children:"Compare"})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:c.address}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:`inline-block px-2 py-1 text-xs font-medium rounded ${c.negotiation_status==="Fixed"?"bg-[#6CA724] text-white":"bg-[#CE3C29] text-white"}`,children:[c.negotiation_status," Price"]}),e.jsxs("span",{className:"text-[#8770BC] text-xl font-bold",children:["$",c.price]})]}),!n&&e.jsx("div",{className:"text-xs text-red-500 mt-2",children:"Location data unavailable for this hospital"})]},c.name)})})})]}),e.jsx("div",{className:`${b?"lg:w-[70%] h-[60vh] lg:h-full":"h-[100vh] lg:h-full"} transition-all duration-500 ease-in-out w-full`,children:e.jsxs(fe,{center:C,zoom:12,zoomControl:!1,className:"h-full w-full z-0",children:[e.jsx(Re,{sidebarOpen:b}),e.jsx(Pe,{location:H}),j.length>0&&e.jsx(Ee,{hospitals:j}),e.jsx(xe,{url:`https://tile.jawg.io/jawg-sunny/{z}/{x}/{y}{r}.png?access-token=${Ce}`,attribution:'<a href="https://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">© <b>Jawg</b>Maps</a> © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),j.map(c=>e.jsx(ye,{position:[c.latitude,c.longitude],icon:ke,children:e.jsx(ve,{children:e.jsx("p",{className:"cursor-pointer",onClick:()=>A({name:c.name}),children:c.name})})},c.name))]})})]}),y.length>0&&e.jsx(ge,{selectedHospitals:y,onRemoveHospital:F})]})})};function Oe(){const{searchResults:r,isHydratingFromURL:d,loading:t}=O(l=>l.hospital),o=d||t,m=r&&r.hospital_count>0;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen flex flex-col hospital_page",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx(oe,{}),e.jsx(ie,{title:"Search Hospitals"}),e.jsx(Ne,{}),o?e.jsx("div",{className:"text-center py-8",children:e.jsx(we,{open:!0})}):m?e.jsxs(e.Fragment,{children:[e.jsx(Se,{serviceName:r.generic_service_name||"",serviceDescription:r.service_description||"",cptCode:r.cpt_hcpcs_code,hasSearchResult:!0,prices:r.prices,hospitalNames:r.hospital_names,labels:[]}),e.jsx(Ae,{})]}):e.jsx(he,{})]}),e.jsx(le,{}),e.jsx(ne,{})]})})}export{Oe as default};
