import{j as e,s as v,t as y,u as b,m as C}from"./radix-hoWLJplZ.js";import{C as D,a as F}from"./card-DZxOaplD.js";import{A as P,a as T,b as I}from"./accordion-BjyaCzib.js";import{a as n,u as M}from"./react-DyejIWKk.js";import{u as R,B as h,y as A,z,A as B,C as E,D as G,E as S,G as k,w as f,J as $}from"./index-Bl-JI4NS.js";import{aa as x,a as L,ab as _,X as J}from"./ui-lp5hxHkm.js";import{D as V,a as O,U as W}from"./UpdateDataForm-D-nyx_qa.js";import{a as H}from"./index-xsH4HHeE.js";import{W as K}from"./WithLoading-B9eRASBv.js";import"./redux-CrWtP8Qi.js";import"./maps-Cu4X6U0v.js";import"./checkbox-IbMsF2G6.js";import"./Spinner-D0Y5dMqM.js";const X=async(s,d)=>{var i,m;const l=new FormData;l.append("image_file",s);try{const t=await H.post("http://123.200.16.106:3838/ocr/cloud_ocr",l,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:d}),a=t.data;if(!a||a.status!=="success"){const u=(a==null?void 0:a.status_code)||t.status;let c=(a==null?void 0:a.error)||(a==null?void 0:a.message)||"Unknown error occurred";throw u===415&&(c="Unsupported file type. Please upload a valid image (JPG, PNG, BMP, TIFF, or GIF)."),new Error(c)}return a.data}catch(t){throw new Error(((m=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:m.error)||t.message||"Upload failed")}},Y=["Itemized Bill","Discharge Summary","Medical Report"],q=()=>{const s=n.useRef(!0),[d,l]=n.useState("Itemized Bill"),[i,m]=n.useState([]),[t,a]=n.useState(!1),[u,c]=n.useState(0),p=R(),g=M(),N=async()=>{if(i.length===0){x.error("Please select a file to upload.");return}const r=i[0];a(!0),c(0),p(f(!0));try{const o=await X(r,j=>{if(!s.current)return;const U=Math.round(j.loaded*100/(j.total||1));c(U)});s.current&&(c(100),p($(o)),p(f(!1)),x.success("Upload complete!"),setTimeout(()=>{s.current&&g("/account/run-audit"),window.scrollTo({top:0,behavior:"smooth"})},500))}catch(o){console.error("Upload failed:",o),s.current&&x.error("Upload failed",{description:o.message||"An unexpected error occurred."})}finally{s.current&&(a(!1),p(f(!1)))}},w=n.useCallback((r,o)=>{x(o,{description:`"${r.name.length>20?`${r.name.slice(0,20)}...`:r.name}" has been rejected`})},[]);return n.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[]),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Hospital Document Type"}),e.jsxs(v,{children:[e.jsx(y,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"w-full sm:w-[240px] justify-between border-gray-300",children:[d,e.jsx(L,{className:"ml-2 h-4 w-4"})]})}),e.jsx(V,{className:"min-w-[200px] w-auto border-gray-300",children:e.jsx(b,{value:d,onValueChange:l,children:Y.map(r=>e.jsx(O,{value:r,children:r},r))})})]})]}),e.jsx("p",{className:"text-sm font-medium",children:"File"}),e.jsxs(A,{maxFiles:1,maxSize:5*1024*1024,value:i,onValueChange:m,onFileReject:w,multiple:!1,children:[e.jsxs("div",{className:"bg-primary-foreground rounded-md p-4",children:[e.jsx("p",{className:"text-left text-black w-full mb-4",children:"Uploading File"}),e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center rounded-full border p-2.5",children:e.jsx(_,{className:"size-6 text-muted-foreground"})}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"text-[#8770BC] font-medium",children:"Click to upload"})," ","or drag and drop"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"PNG or JPG"}),e.jsx("p",{className:"text-xs text-gray-400",children:"(max 5MB)"})]})})]}),e.jsx(B,{children:i.map((r,o)=>e.jsxs(E,{value:r,className:"border-gray-300",children:[e.jsx("div",{className:"w-[50px] h-[50px] overflow-hidden rounded-md border border-gray-300",children:e.jsx(G,{className:"object-cover w-full h-full"})}),e.jsx(S,{}),e.jsx(k,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",className:"size-7",children:e.jsx(J,{})})})]},o))})]}),t&&e.jsxs("div",{className:"w-full mt-4",children:[e.jsx("div",{className:"relative h-3 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-purple transition-all duration-300",style:{width:`${u}%`}})}),e.jsxs("p",{className:"text-xs text-right mt-1",children:[u,"%"]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(h,{onClick:N,className:"w-auto min-w-[120px] bg-purple",disabled:t,children:t?"Uploading...":"Upload"})})]})},Q=[{title:"Upload File",component:e.jsx(q,{})},{title:"Update Data",component:e.jsx(W,{})}];function ue(){return e.jsxs(K,{sliceKey:"audit",children:[e.jsx("h2",{className:"text-lg font-medium text-[#8770BC] ml-10",children:"Upload Document"}),Q.map(({title:s,component:d},l)=>e.jsx(D,{className:"max-w-xl mx-auto mt-10 border-gray-300",children:e.jsx(F,{className:"upload-file-card-content",children:e.jsx(C,{type:"single",collapsible:!0,defaultValue:"section-0",className:"w-full",children:e.jsxs(P,{value:`section-${l}`,className:"upload-file-accordion-item",children:[e.jsx(T,{children:s}),e.jsx(I,{children:d})]})})})},l))]})}export{ue as default};
